{% extends "admin/base.html" %}

{% block title %}Categories{% if zip_code %} - Zip {{ zip_code }}{% endif %}{% endblock %}

{% block content %}
<div id="categoriesTab" class="tab-content">
    <div class="relevance-container">
        <h2 style="margin-bottom: 1.5rem;">Category Classification System</h2>
        
        <div class="relevance-section" style="margin-bottom: 2rem; padding: 1.5rem; background: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 8px; position: relative;">
            <div style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;" onclick="toggleExplanation('categoriesExplanation')">
                <h3 style="margin: 0; color: #333;">ðŸ“š How Category Classification Works</h3>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span id="categoriesExplanationToggle" style="font-size: 1.2rem; user-select: none;">â–¼</span>
                    <button onclick="event.stopPropagation(); closeExplanation('categoriesExplanation')" style="background: rgba(0,0,0,0.1); border: none; color: #333; font-size: 1.2rem; cursor: pointer; padding: 0.25rem 0.5rem; border-radius: 4px; font-weight: bold;" title="Close">Ã—</button>
                </div>
            </div>
            <div id="categoriesExplanation" style="margin-top: 1rem; color: #666; font-size: 0.95rem; line-height: 1.8; display: none;">
                <p style="margin: 0 0 1rem 0;">
                    <strong>Fast Keyword-Based + Bayesian Learning:</strong> This system uses a sophisticated two-stage approach to automatically categorize articles into the appropriate sections of your news site.
                </p>
                <h4 style="margin: 1rem 0 0.5rem 0; font-size: 1.1rem; color: #1a1a1a;">Two-Stage Classification:</h4>
                <ul style="margin: 0.5rem 0 1rem 0; padding-left: 1.5rem;">
                    <li style="margin-bottom: 0.5rem;"><strong>Stage 1 - Category Mapping:</strong> Articles with explicit category fields (news, sports, entertainment, etc.) are first mapped to category slugs using the CATEGORY_MAPPING system. For example, "news" and "local" both map to "local-news", while "entertainment" maps to "events".</li>
                    <li style="margin-bottom: 0.5rem;"><strong>Stage 2 - Keyword Matching:</strong> If an article doesn't have a category field or the mapping doesn't match the target category, the system searches the article's title and content for category-specific keywords. Each category has a curated list of keywords (e.g., "crime" category looks for: crime, police, arrest, suspect, investigation, charges, court, trial, criminal).</li>
                </ul>
                <h4 style="margin: 1rem 0 0.5rem 0; font-size: 1.1rem; color: #1a1a1a;">Category Slugs:</h4>
                <p style="margin: 0.5rem 0 1rem 0;">
                    The system uses URL-friendly category slugs (local-news, crime, sports, events, business, schools, food, obituaries) that map to user-friendly display names. These slugs are used in the website URLs and navigation, making the site structure clean and organized.
                </p>
                <h4 style="margin: 1rem 0 0.5rem 0; font-size: 1.1rem; color: #1a1a1a;">Keyword Lists:</h4>
                <p style="margin: 0.5rem 0 1rem 0;">
                    Each category has a carefully curated list of keywords that help identify relevant articles. For example, the "crime" category includes keywords like: crime, police, arrest, suspect, investigation, charges, court, trial, criminal. The "sports" category includes: sport, football, basketball, baseball, hockey, athlete, game, team, player. These keywords are matched against both the article title and content to determine the best category fit.
                </p>
                <h4 style="margin: 1rem 0 0.5rem 0; font-size: 1.1rem; color: #1a1a1a;">Automatic Processing:</h4>
                <p style="margin: 0.5rem 0 0 0;">
                    When articles are ingested, they're automatically categorized using this system. You can manually recategorize articles or use the "Recategorize All Articles" button to reprocess all articles with updated keyword lists. The system also supports Bayesian learning to improve categorization accuracy over time based on your corrections.
                </p>
            </div>
        </div>
        
        <div class="relevance-section" style="margin-bottom: 2rem; padding: 1.5rem; background: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 8px;">
            <h3 style="margin-top: 0; margin-bottom: 1rem; color: #333;">Recategorize All Articles</h3>
            <button onclick="recategorizeAllArticles()" style="padding: 0.75rem 1.5rem; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">ðŸ”„ Recategorize All Articles</button>
            <p style="margin-top: 0.5rem; color: #666; font-size: 0.9rem;">Update all article categories based on current keywords and training data.</p>
        </div>
        
        <div class="relevance-section" style="margin-bottom: 2rem; padding: 1.5rem; background: #fff3e0; border-left: 4px solid #ff9800; border-radius: 8px;">
            <h3 style="margin-top: 0; margin-bottom: 1rem; color: #333;">Recalculate Category Info</h3>
            <button onclick="recalculateCategoryInfo()" style="padding: 0.75rem 1.5rem; background: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">ðŸ”„ Recalculate Category Info</button>
            <p style="margin-top: 0.5rem; color: #666; font-size: 0.9rem;">Update categories, primary categories, and local focus scores for all articles.</p>
        </div>
        
        <div class="relevance-section" style="margin-bottom: 2rem; padding: 1.5rem; background: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 8px;">
            <h3 style="margin-top: 0; margin-bottom: 1rem; color: #333;">Retrain All Categories</h3>
            <button onclick="retrainAllCategories()" style="padding: 0.75rem 1.5rem; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">ðŸ”„ Retrain All Categories</button>
        </div>
        
        <div class="relevance-section" style="margin-bottom: 2rem; padding: 1.5rem; background: white; border-radius: 8px;">
            <h3 style="margin-top: 0; margin-bottom: 1rem; color: #333;">Category Statistics</h3>
            <div id="categoryStats" style="padding: 1rem; background: #f5f5f5; border-radius: 4px;">
                <p style="color: #666; text-align: center;">Loading statistics...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

