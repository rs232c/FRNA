{% extends "admin/base.html" %}

{% block title %}Sources{% if zip_code %} - Zip {{ zip_code }}{% endif %}{% endblock %}

{% block content %}
<div id="sourcesTab" class="tab-content">
    <div class="sources-list">
        {% if sources|length == 0 %}
        <div style="padding: 2rem; text-align: center; background: #252525; border-radius: 8px; margin-bottom: 1rem; border: 1px solid #404040;">
            <p style="color: #666; margin-bottom: 1rem;">No sources configured for this zip code.</p>
            <button onclick="addNewSource()" style="padding: 0.75rem 1.5rem; background: #0078d4; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">
                + Add Source
            </button>
        </div>
        {% else %}
        {% for source_key, source_config in sources.items() %}
        <div class="source-item">
            <div class="source-info">
                <div class="source-name">{{ source_config.name }}</div>
                <div class="source-url">{{ source_config.url }}</div>
                <div class="source-rss" style="color: #888; font-size: 0.85rem; margin-top: 0.25rem;">
                    RSS: <span style="color: #aaa; font-family: monospace;">{{ source_config.get('rss', 'None (web scraping)') }}</span>
                </div>
                <div class="source-category">Category: {{ source_config.get('category', 'news') }}</div>
                {% if source_config.get('_relevance_score') is not none and source_config.get('_relevance_score') >= 0 %}
                <div class="source-relevance" style="color: #666; font-size: 0.9rem; margin-top: 0.25rem;">
                    Relevance Score: <strong style="color: {% if source_config.get('_relevance_score', 0) >= 20 %}#4caf50{% elif source_config.get('_relevance_score', 0) >= 10 %}#ff9800{% else %}#f44336{% endif %};">{{ "%.1f"|format(source_config.get('_relevance_score')) }}</strong> points
                </div>
                {% else %}
                <div class="source-relevance" style="color: #999; font-size: 0.9rem; margin-top: 0.25rem; font-style: italic;">
                    No relevance score set
                </div>
                {% endif %}
            </div>
            <div class="source-actions" style="display: flex; gap: 0.5rem; align-items: center;">
                <button class="source-enabled-btn" data-source="{{ source_key }}" data-state="{{ 'on' if source_config.get('enabled', True) else 'off' }}" 
                        style="padding: 0.5rem; background: {% if source_config.get('enabled', True) %}#4caf50{% else %}transparent{% endif %}; color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 1.2rem; opacity: {% if source_config.get('enabled', True) %}1{% else %}0.5{% endif %}; width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s;"
                        title="{% if source_config.get('enabled', True) %}Disable source{% else %}Enable source{% endif %}">
                    {% if source_config.get('enabled', True) %}✓{% else %}✕{% endif %}
                </button>
                <button class="edit-source-btn" data-source-key="{{ source_key }}" title="Edit source" onclick="if(typeof window.editSource==='function'){window.editSource('{{ source_key }}');}"
                        style="padding: 0.5rem; background: #252525; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1.2rem; transition: all 0.2s;"
                        onmouseover="this.style.background='#333'; this.style.transform='scale(1.05)'"
                        onmouseout="this.style.background='#252525'; this.style.transform='scale(1)'">
                    ✏️
                </button>
            </div>
        </div>
        {% endfor %}
        <div style="margin-top: 1.5rem;">
            <button onclick="addNewSource()" style="padding: 0.75rem 1.5rem; background: #0078d4; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">
                + Add Source
            </button>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

