<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ category_name }} - {{ title }}</title>
    <meta name="description" content="{{ category_name }} news and updates from {{ locale }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'edge-bg': '#0d0d0d',
                        'edge-surface': '#161616',
                        'edge-elevated': '#1f1f1f',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="{{ css_path }}style.css?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}">
    <style>
        .lazy-image { opacity: 0; transition: opacity 0.3s; }
        .lazy-image.loaded { opacity: 1; }
    </style>
</head>
<body class="bg-[#0a0a0a] text-gray-100 min-h-screen">
    <!-- Top Bar -->
    <div class="bg-[#0a0a0a]/50 backdrop-blur-sm border-b border-gray-900/30 py-2">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="w-full sm:w-auto flex-1">
                    <div class="relative flex items-center bg-[#161616]/50 backdrop-blur-sm rounded-full px-4 py-2 border border-gray-800/20">
                        <span class="text-gray-400 mr-2">üîç</span>
                        <input type="text" placeholder="Search articles..." class="bg-transparent border-none outline-none text-gray-100 placeholder-gray-400 flex-1 w-full sm:w-64" id="searchInput">
                        <button id="mobileNavToggle" class="text-gray-200 hover:text-white transition-colors ml-2 px-2 py-1 rounded-lg hover:bg-[#161616]/50 border border-gray-800" aria-label="Toggle navigation menu" title="Menu & Category Controls">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <!-- Desktop Admin Button -->
                    <a href="/admin" id="hamburgerMenuLink" class="hidden lg:inline-flex bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-lg transition-colors items-center justify-center w-10 h-10" title="Admin Panel">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </a>
                    <script>
                        console.log('[FRNA] ‚úÖ Category page navigation buttons initialized');
                        // Update admin link based on session
                        (function() {
                            fetch('/api/session-check')
                                .then(response => response.json())
                                .then(data => {
                                    const link = document.getElementById('hamburgerMenuLink');
                                    if (data.logged_in && data.zip_code) {
                                        link.href = `/admin/${data.zip_code}`;
                                    } else {
                                        link.href = '/admin';
                                    }
                                })
                                .catch(err => {
                                    console.error('Error checking session:', err);
                                });
                        })();
                    </script>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-[#0a0a0a]/80 backdrop-blur-md border-b border-gray-900/20 py-2 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="text-xl font-semibold text-blue-400">FRNA</div>
                {{ nav_tabs }}
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative">
        <!-- Fixed Location Badge (Top-Left) -->
        <div class="fixed top-4 left-4 z-50 text-white px-4 py-2 rounded-full text-sm font-semibold shadow-lg" style="background: rgba(147, 51, 234, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);">
            {{ location_badge_text }}
        </div>
        
        <!-- Fixed Weather Pill (Top-Right) -->
        <a href="{{ weather_station_url }}" target="_blank" rel="noopener" class="fixed top-4 right-4 z-50 flex items-center gap-2 rounded-lg px-4 py-2 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105" style="background: rgba(37, 99, 235, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);" onmouseover="this.style.background='rgba(37, 99, 235, 0.5)'; this.style.border='1px solid rgba(255, 255, 255, 0.2)';" onmouseout="this.style.background='rgba(37, 99, 235, 0.4)'; this.style.border='1px solid rgba(255, 255, 255, 0.1)';">
            <span class="text-xl">{{ weather_icon }}</span>
            <div class="text-white">
                <div class="font-bold text-sm leading-tight">{{ weather.current.temperature }}{{ weather.current.unit }}</div>
                <div class="text-blue-100 text-xs">{{ weather.current.condition }}</div>
            </div>
        </a>
        
        <!-- Category Header -->
        <h1 class="text-4xl font-bold mb-10 text-gray-100">{{ category_name }}</h1>

        <!-- Hero + Trending Row (65/35 split) -->
        {% if hero_articles and hero_articles|length > 0 %}
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-10 items-start">
            <!-- Massive Hero Carousel (65% - 8 columns) -->
            <div class="lg:col-span-8">
                <div class="relative rounded-xl overflow-hidden shadow-2xl h-[400px] lg:h-[600px]" style="overflow: hidden;">
                    <!-- Carousel Container -->
                    <div class="top-stories-track relative h-full" style="display: flex; width: calc(100% * {{ hero_articles|length }}); transition: transform 0.5s ease-in-out;">
                        {% for hero_article in hero_articles %}
                        <div class="story-slide flex-shrink-0 h-full relative" style="flex: 0 0 calc(100% / {{ hero_articles|length }}); width: calc(100% / {{ hero_articles|length }});">
                            <a href="{{ hero_article.url }}" target="_blank" rel="noopener" class="group block relative w-full h-full">
                                {% if show_images and hero_article.image_url and (hero_article.image_url|default('')|trim) %}
                                <div class="relative h-full overflow-hidden">
                                    <img src="{{ hero_article.image_url }}" alt="{{ hero_article.title }}" loading="lazy" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                                    <!-- Dark gradient overlay bottom 40% -->
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent" style="background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.5) 40%, transparent 100%);"></div>
                                    <!-- Video play icon if video -->
                                    {% if hero_article._is_video %}
                                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20">
                                        <div class="bg-white/90 rounded-full p-4 shadow-2xl">
                                            <svg class="w-16 h-16 text-gray-900" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M8 5v14l11-7z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    {% endif %}
                                    <!-- Content overlay at bottom -->
                                    <div class="absolute bottom-0 left-0 right-0 p-8 lg:p-10">
                                        <h2 class="text-3xl lg:text-4xl font-bold text-white mb-3 line-clamp-3 group-hover:text-blue-300 transition-colors leading-[1.15]">
                                            {{ hero_article.title }}
                                        </h2>
                                        <div class="flex items-center gap-3 text-sm text-gray-200">
                                            <span class="font-medium">{{ hero_article.source_display }}</span>
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.formatted_date.split(' at ')[0] if ' at ' in hero_article.formatted_date else 'Recently' }}</span>
                                            {% if hero_article.reading_time %}
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.reading_time }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <div class="relative h-full overflow-hidden bg-gradient-to-br {{ hero_article.source_gradient }}">
                                    <!-- Subtle pattern overlay -->
                                    <div class="absolute inset-0 opacity-5" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,255,255,0.03) 20px, rgba(255,255,255,0.03) 40px);"></div>
                                    <!-- City skyline silhouette -->
                                    <div class="absolute bottom-0 left-0 right-0 h-32 opacity-3">
                                        <svg viewBox="0 0 400 100" class="w-full h-full" preserveAspectRatio="none">
                                            <path d="M0,100 L0,85 L15,82 L30,78 L45,75 L60,72 L75,70 L90,68 L105,66 L120,64 L135,62 L150,60 L165,58 L180,56 L195,54 L210,52 L225,50 L240,52 L255,54 L270,56 L285,58 L300,60 L315,62 L330,64 L345,66 L360,68 L375,70 L385,72 L400,75 L400,100 Z" fill="white"/>
                                        </svg>
                                    </div>
                                    <!-- Video play icon if video -->
                                    {% if hero_article._is_video %}
                                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20">
                                        <div class="bg-white/90 rounded-full p-4 shadow-2xl">
                                            <svg class="w-16 h-16 text-gray-900" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M8 5v14l11-7z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    {% endif %}
                                    <!-- Content overlay at bottom -->
                                    <div class="absolute bottom-0 left-0 right-0 p-8 lg:p-10 bg-gradient-to-t from-black/95 via-black/70 to-transparent">
                                        <h2 class="text-3xl lg:text-4xl font-bold text-white mb-3 line-clamp-3 group-hover:text-blue-300 transition-colors leading-[1.15]">
                                            {{ hero_article.title }}
                                        </h2>
                                        <div class="flex items-center gap-3 text-sm text-gray-200">
                                            <span class="font-medium">{{ hero_article.source_display }}</span>
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.formatted_date.split(' at ')[0] if ' at ' in hero_article.formatted_date else 'Recently' }}</span>
                                            {% if hero_article.reading_time %}
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.reading_time }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Navigation Arrows -->
                    {% if hero_articles|length > 1 %}
                    <button onclick="prevTopStory()" class="absolute left-4 top-1/2 transform -translate-y-1/2 z-30 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full p-3 transition-all duration-300 hover:scale-110" aria-label="Previous article">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button onclick="nextTopStory()" class="absolute right-4 top-1/2 transform -translate-y-1/2 z-30 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full p-3 transition-all duration-300 hover:scale-110" aria-label="Next article">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                    
                    <!-- Navigation Dots -->
                    <div class="slider-dots absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 z-30">
                        {% for i in range(hero_articles|length) %}
                        <button onclick="goToTopStory({{ i }})" class="dot w-3 h-3 rounded-full {% if loop.first %}bg-white{% else %}bg-white/40{% endif %} hover:bg-white/60 transition-colors cursor-pointer" data-index="{{ i }}"></button>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Narrow Trending Sidebar (35% - 4 columns) -->
            <aside class="lg:col-span-4">
                <div class="rounded-xl p-6" style="background: rgba(16, 16, 16, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div class="flex items-center gap-2 mb-6">
                        <span class="text-2xl">üî•</span>
                        <h3 class="text-lg font-bold text-gray-100">Trending in {{ locale.split(',')[0] if ',' in locale else locale }}</h3>
                    </div>
                    <div class="space-y-4">
                        {% if trending_articles %}
                            {% for article in trending_articles[:8] %}
                            <a href="{{ article.url }}" target="_blank" rel="noopener" class="block group">
                                <div class="flex items-center gap-3 pb-2 border-b border-gray-800/30 last:border-0 -mx-2 px-2 rounded-lg transition-colors" onmouseover="this.style.background='rgba(26, 26, 26, 0.3)';" onmouseout="this.style.background='transparent';">
                                    {% if show_images and article.image_url and (article.image_url|default('')|trim) %}
                                    <div class="flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden bg-gradient-to-br from-[#161616] to-[#0f0f0f]">
                                        <img src="{{ article.image_url }}" alt="{{ article.title }}" loading="lazy" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">
                                    </div>
                                    {% else %}
                                    <div class="flex-shrink-0 w-16 h-16 rounded-lg bg-gradient-to-br {{ article.source_gradient }} flex items-center justify-center relative overflow-hidden">
                                        <div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,0.05) 5px, rgba(255,255,255,0.05) 10px);"></div>
                                        <div class="text-lg font-black text-white/90 drop-shadow-lg relative z-10">{{ article.source_initials }}</div>
                                    </div>
                                    {% endif %}
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-1 mb-1">
                                            <span class="text-sm">üî•</span>
                                            <h4 class="text-sm font-semibold text-gray-100 group-hover:text-orange-400 transition-colors line-clamp-2">{{ article.title }}</h4>
                                        </div>
                                        <div class="text-xs text-gray-500">{{ article.source_display }} ‚Ä¢ {{ article.formatted_date.split(' at ')[0] if ' at ' in article.formatted_date else 'Recently' }}</div>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        {% else %}
                            <p class="text-gray-400 text-sm">No trending articles yet.</p>
                        {% endif %}
                    </div>
                </div>
            </aside>
        </div>
        {% endif %}
        
        <!-- Perfect Masonry Grid Below Hero (3-4 columns) -->
        {% if articles %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="articlesGrid">
            {% for article in articles %}
            <article class="rounded-xl overflow-hidden shadow-lg hover:shadow-2xl hover:shadow-blue-500/20 transition-all duration-300 hover:scale-[1.02]" style="background: rgba(16, 16, 16, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);" onmouseover="this.style.background='rgba(16, 16, 16, 0.5)'; this.style.border='1px solid rgba(255, 255, 255, 0.2)'; this.style.boxShadow='0 0 20px rgba(255, 255, 255, 0.1)';" onmouseout="this.style.background='rgba(16, 16, 16, 0.4)'; this.style.border='1px solid rgba(255, 255, 255, 0.1)'; this.style.boxShadow='';" data-category="{{ article.category }}" data-neighborhoods="{{ article.neighborhoods|join(',') if article.neighborhoods else '' }}">
                <a href="{{ article.url }}" target="_blank" rel="noopener" class="block">
                    {% if show_images and article.image_url and (article.image_url|default('')|trim) %}
                    <div class="relative aspect-square overflow-hidden" style="border-radius: 12px;">
                        <img src="{{ article.image_url }}" alt="{{ article.title }}" loading="lazy" class="w-full h-full object-cover">
                        <!-- Source initials in top-right corner -->
                        <div class="absolute top-3 right-3 px-3 py-1.5 rounded-full text-sm font-bold text-white" style="background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 0 10px {{ article.source_glow_color }};">
                            {{ article.source_initials }}
                        </div>
                        <!-- Dark overlay gradient bottom 40% -->
                        <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent"></div>
                        <!-- Title overlay bottom-left -->
                        <div class="absolute bottom-0 left-0 right-0 p-3">
                            <h2 class="text-[1.4rem] font-bold text-white mb-2 line-clamp-2 leading-[1.15]">
                                {{ article.title }}
                            </h2>
                            <div class="flex items-center justify-between">
                                <!-- Time + read time -->
                                <div class="text-xs text-gray-300">
                                    {{ article.formatted_date.split(' at ')[0] if ' at ' in article.formatted_date else 'Recently' }}{% if article.reading_time %} ‚Ä¢ {{ article.reading_time }}{% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <!-- Placeholder with square ratio and gradient background -->
                    <div class="relative aspect-square overflow-hidden bg-gradient-to-br {{ article.source_gradient }}" style="border-radius: 12px;">
                        <!-- Subtle pattern overlay for texture -->
                        <div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,255,255,0.03) 20px, rgba(255,255,255,0.03) 40px);"></div>
                        <!-- Source initials in top-right corner -->
                        <div class="absolute top-3 right-3 px-3 py-1.5 rounded-full text-sm font-bold text-white" style="background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 0 10px {{ article.source_glow_color }};">
                            {{ article.source_initials }}
                        </div>
                        <!-- Image placeholder icon centered -->
                        <div class="absolute inset-0 flex items-center justify-center">
                            <svg class="w-16 h-16 text-white/40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <!-- Dark overlay gradient bottom 40% -->
                        <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent"></div>
                        <!-- Title overlay bottom-left -->
                        <div class="absolute bottom-0 left-0 right-0 p-3">
                            <h2 class="text-[1.4rem] font-bold text-white mb-2 line-clamp-2 leading-[1.15]">
                                {{ article.title }}
                            </h2>
                            <div class="flex items-center justify-between">
                                <!-- Time + read time -->
                                <div class="text-xs text-gray-300">
                                    {{ article.formatted_date.split(' at ')[0] if ' at ' in article.formatted_date else 'Recently' }}{% if article.reading_time %} ‚Ä¢ {{ article.reading_time }}{% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </a>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <div class="rounded-xl p-12 text-center" style="background: rgba(16, 16, 16, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="max-w-md mx-auto">
                <div class="text-6xl mb-4">üì∞</div>
                <h3 class="text-2xl font-bold text-gray-100 mb-3">{{ category_name }}</h3>
                <p class="text-gray-400 text-lg mb-2">No articles found in this category yet.</p>
                <p class="text-gray-500 text-sm mb-6">We're constantly updating our content. Check back soon for the latest {{ category_name.lower() }} news!</p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center">
                    <a href="{{ home_path }}index.html" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium">‚Üê Back to Local</a>
                    <a href="{{ home_path }}index.html" class="px-6 py-3 bg-[#1a1a1a] hover:bg-[#222] text-gray-300 rounded-lg transition-colors font-medium border border-gray-800/30">View All News</a>
                </div>
            </div>
        </div>
        {% endif %}
    </main>
    
    <!-- Footer -->
    <footer class="bg-[#0a0a0a] border-t border-gray-900/30 mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-400 text-sm">
            <p>&copy; {{ current_year }} {{ locale }} News. All rights reserved.</p>
        </div>
    </footer>
    
    <!-- Load scripts in dependency order -->
    <script src="{{ home_path }}js/storage.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="{{ home_path }}js/categorizer.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="{{ home_path }}js/news-fetcher.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="{{ home_path }}js/article-renderer.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="{{ home_path }}js/weather.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="{{ home_path }}js/tabs.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="{{ home_path }}js/stats.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="{{ home_path }}js/main.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="{{ home_path }}js/zip-router.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script>console.log('[FRNA] ‚úÖ Category page loaded with cache-busting - build:', '{{ current_time }}');</script>
    <script>
        // Lazy load images with data-src
        document.addEventListener('DOMContentLoaded', function() {
            const images = document.querySelectorAll('img[data-src]');
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        if (img.dataset.src) {
                            img.src = img.dataset.src;
                            img.removeAttribute('data-src');
                            img.classList.add('loaded');
                            observer.unobserve(img);
                        }
                    }
                });
            }, { rootMargin: '50px' });
            images.forEach(img => imageObserver.observe(img));
        });
    </script>
    
    <!-- Generation Timestamp Badge (Bottom-Right) -->
    <div class="fixed bottom-4 right-4 z-50 text-gray-500 px-3 py-1.5 rounded-lg text-xs font-mono shadow-lg" style="background: rgba(16, 16, 16, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05);">
        <div>Generated: {{ generation_timestamp }}</div>
        {% if last_db_update %}<div>DB Updated: {{ last_db_update }}</div>{% endif %}
    </div>
</body>
</html>