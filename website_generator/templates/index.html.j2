<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <meta name="description" content="{{ description }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'edge-bg': '#0d0d0d',
                        'edge-surface': '#161616',
                        'edge-elevated': '#1f1f1f',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/style.css?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}">
    <style>
        /* Custom styles for things Tailwind can't handle */
        .lazy-image { opacity: 0; transition: opacity 0.3s; }
        .lazy-image.loaded { opacity: 1; }

        /* Prevent FOUC - hide content until JS loads */
        .fouc-hidden { opacity: 0; transition: opacity 0.3s; }
        .fouc-hidden.loaded { opacity: 1; }

        /* Ensure dark theme is applied immediately */
        html.dark body { background: #0a0a0a !important; color: #ffffff !important; }
    </style>
</head>
<body class="bg-[#0a0a0a] text-gray-100 min-h-screen fouc-hidden">
    <!-- Top Bar -->
    <div class="bg-[#0a0a0a]/50 backdrop-blur-sm border-b border-gray-900/30 py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Mobile: Hamburger + Centered Search | Desktop: Just Centered Search -->
            <div class="flex flex-col gap-4">
                <!-- Header Row: Hamburger Menu + Admin Button (Always Visible) -->
                <div class="flex items-center justify-between">
                    <button id="mobileNavToggle" class="text-gray-200 hover:text-white transition-colors p-3 rounded-lg hover:bg-[#161616]/50 border border-gray-800/50" aria-label="Toggle navigation menu" title="Menu & Category Controls">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <a href="/admin" id="hamburgerMenuLink" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-lg transition-colors" title="Admin Panel">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                    </a>
                </div>

                <!-- Centered Search Bar - Full Width and Prominent -->
                <div class="w-full max-w-4xl mx-auto">
                    <div class="relative flex items-center bg-[#161616]/60 backdrop-blur-sm rounded-full px-6 py-4 border border-gray-800/30 focus-within:border-blue-500/60 focus-within:ring-2 focus-within:ring-blue-500/20 transition-all duration-300 shadow-lg">
                        <span class="text-gray-400 mr-4 text-xl">üîç</span>
                        <input type="text" placeholder="Search all articles..." class="bg-transparent border-none outline-none text-gray-100 placeholder-gray-400 flex-1 w-full text-lg" id="searchInput">
                        <button class="text-gray-400 hover:text-blue-400 transition-colors ml-4 p-2 rounded-full hover:bg-gray-800/50" onclick="toggleSearchFilters()" title="Advanced Filters">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Advanced Search Filters -->
                <div class="hidden w-full max-w-6xl mx-auto" id="searchFilters">
                    <div class="p-6 rounded-xl bg-[#161616]/60 backdrop-blur-sm border border-white/10 shadow-xl">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Category:</label>
                                <select id="filterCategory" class="w-full text-gray-100 rounded-lg px-3 py-2 text-sm focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 bg-[#161616]/60 backdrop-blur-sm border border-white/10">
                                    <option value="">All Categories</option>
                                    <option value="news">üì∞ News</option>
                                    <option value="entertainment">üé¨ Entertainment</option>
                                    <option value="sports">‚öΩ Sports</option>
                                    <option value="local">üìç Local</option>
                                    <option value="media">üé• Media</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Neighborhood:</label>
                                <select id="filterNeighborhood" class="w-full text-gray-100 rounded-lg px-3 py-2 text-sm focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 bg-[#161616]/60 backdrop-blur-sm border border-white/10">
                                    <option value="">All Neighborhoods</option>
                                    <option value="north end">North End</option>
                                    <option value="south end">South End</option>
                                    <option value="highlands">Highlands</option>
                                    <option value="flint village">Flint Village</option>
                                    <option value="maplewood">Maplewood</option>
                                    <option value="downtown">Downtown</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Source:</label>
                                <select id="filterSource" class="w-full text-gray-100 rounded-lg px-3 py-2 text-sm focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 bg-[#161616]/60 backdrop-blur-sm border border-white/10">
                                    <option value="">All Sources</option>
                                    {% for source in sources %}
                                    <option value="{{ source }}">{{ source }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date Range:</label>
                                <select id="filterDateRange" class="w-full text-gray-100 rounded-lg px-3 py-2 text-sm focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 bg-[#161616]/60 backdrop-blur-sm border border-white/10">
                                    <option value="">All Time</option>
                                    <option value="today">Today</option>
                                    <option value="week">Last 7 Days</option>
                                    <option value="month">Last 30 Days</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button class="w-full text-gray-100 px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-[#161616]/60 backdrop-blur-sm border border-white/10 hover:bg-[#1a1a1a]/70 hover:border-white/20" onclick="clearFilters()">Clear Filters</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </a>
                    <script>
                        console.log('[FRNA] ‚úÖ Navigation buttons initialized');
                        // Update admin link based on session
                        (function() {
                            fetch('/api/session-check')
                                .then(response => response.json())
                                .then(data => {
                                    const link = document.getElementById('hamburgerMenuLink');
                                    if (data.logged_in && data.zip_code) {
                                        link.href = `/admin/${data.zip_code}`;
                                    } else {
                                        link.href = '/admin';
                                    }
                                })
                                .catch(err => {
                                    console.error('Error checking session:', err);
                                });
                        })();
                    </script>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-[#0a0a0a]/80 backdrop-blur-md border-b border-gray-900/20 py-2 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="text-xl font-semibold text-blue-400">FRNA</div>
                {{ nav_tabs }}
            </div>
        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div id="mobileMenu" class="fixed inset-0 z-[9999] bg-black/60 backdrop-blur-xl hidden">
        <div class="fixed top-0 right-0 w-80 h-full bg-[#0a0a0a]/95 backdrop-blur-xl border-l border-gray-800/50 transform translate-x-full transition-transform duration-300 ease-in-out" id="mobileMenuPanel">
            <div class="flex flex-col h-full">
                <!-- Header -->
                <div class="flex items-center justify-between p-6 border-b border-gray-800/50">
                    <h2 class="text-xl font-bold text-white">Navigation</h2>
                    <button id="closeMobileMenu" class="text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800/50">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Menu Content -->
                <div class="flex-1 overflow-y-auto p-6">
                    <!-- Categories -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-300 mb-4">Categories</h3>
                        <div class="space-y-2">
                            <a href="/" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">üè† All News</a>
                            <a href="/category/business" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">üíº Business</a>
                            <a href="/category/crime" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">üöî Crime</a>
                            <a href="/category/events" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">üìÖ Events</a>
                            <a href="/category/food" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">üçΩÔ∏è Food</a>
                            <a href="/category/local-news" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">üì∞ Local News</a>
                            <a href="/category/meetings" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">üèõÔ∏è Meetings</a>
                            <a href="/category/obituaries" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">‚ö±Ô∏è Obituaries</a>
                            <a href="/category/scanner" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">üìª Scanner</a>
                            <a href="/category/schools" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">üè´ Schools</a>
                            <a href="/category/sports" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">‚öΩ Sports</a>
                            <a href="/category/weather" class="block px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">üå§Ô∏è Weather</a>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="border-t border-gray-800/50 pt-6">
                        <h3 class="text-lg font-semibold text-gray-300 mb-4">Actions</h3>
                        <div class="space-y-2">
                            <a href="/admin" class="block px-4 py-3 text-blue-400 hover:text-blue-300 hover:bg-blue-900/20 rounded-lg transition-colors">‚öôÔ∏è Admin Panel</a>
                            <button onclick="toggleSearchFilters()" class="w-full text-left px-4 py-3 text-gray-300 hover:text-white hover:bg-gray-800/50 rounded-lg transition-colors">üîç Search Filters</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative">
        <!-- Fixed Location Badge (Top-Left) -->
        <div class="fixed top-4 left-4 z-50 text-white px-4 py-2 rounded-full text-sm font-semibold shadow-lg bg-purple-500/40 backdrop-blur-xl border border-white/10">
            {{ location_badge_text }}
        </div>
        
        <!-- Fixed Weather Pill (Top-Right) -->
        <a href="{{ weather_station_url }}" target="_blank" rel="noopener" id="weatherPill" class="fixed top-4 right-4 z-50 flex items-center gap-2 rounded-lg px-4 py-2 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 bg-blue-500/40 backdrop-blur-xl border border-white/10 hover:bg-blue-500/50 hover:border-white/20">
            <span id="weatherIcon" class="text-xl">üå§Ô∏è</span>
            <div class="text-white">
                <div id="weatherTemp" class="font-bold text-sm leading-tight">--¬∞F</div>
                <div id="weatherCondition" class="text-blue-100 text-xs">Loading...</div>
            </div>
        </a>
        
        <!-- Hero + Trending Row (65/35 split) -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-10 items-start">
            <!-- Massive Hero Carousel (65% - 8 columns) -->
            <div class="lg:col-span-8">
                {% if hero_articles and hero_articles|length > 0 %}
                <div class="relative rounded-xl overflow-hidden shadow-2xl h-[400px] lg:h-[600px] hero-carousel-container" style="overflow: hidden;">
                    <!-- Carousel Container -->
                    <div class="top-stories-track h-full" style="display: flex; transition: transform 0.5s ease-in-out;">
                        {% for hero_article in hero_articles %}
                        <div class="story-slide flex-shrink-0 h-full relative" style="flex: 0 0 calc(100% / {{ hero_articles|length }}); width: calc(100% / {{ hero_articles|length }});">
                            <a href="{{ hero_article.url }}" target="_blank" rel="noopener" class="group block relative w-full h-full">
                                {% if show_images and hero_article.image_url and (hero_article.image_url|default('')|trim) %}
                                <div class="relative h-full overflow-hidden">
                                    <img src="{{ hero_article.image_url }}" alt="{{ hero_article.title }}" loading="lazy" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                                    <!-- Dark gradient overlay bottom 40% -->
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent" style="background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.5) 40%, transparent 100%);"></div>
                                    <!-- Video play icon if video -->
                                    {% if hero_article._is_video %}
                                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20">
                                        <div class="bg-white/90 rounded-full p-4 shadow-2xl">
                                            <svg class="w-16 h-16 text-gray-900" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M8 5v14l11-7z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    {% endif %}
                                    <!-- Content overlay at bottom -->
                                    <div class="absolute bottom-0 left-0 right-0 p-6 lg:p-8 pb-12 lg:pb-16">
                                        <h2 class="text-2xl lg:text-3xl font-bold text-white mb-3 line-clamp-5 group-hover:text-blue-300 transition-colors leading-tight">
                                            {{ hero_article.title }}
                                        </h2>
                                        <div class="flex items-center gap-3 text-sm text-gray-200">
                                            <span class="font-medium">{{ hero_article.source_display }}</span>
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.formatted_date.split(' at ')[0] if ' at ' in hero_article.formatted_date else 'Recently' }}</span>
                                            {% if hero_article.reading_time %}
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.reading_time }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <div class="relative h-full overflow-hidden bg-gradient-to-br {{ hero_article.source_gradient }}">
                                    <!-- Subtle pattern overlay -->
                                    <div class="absolute inset-0 opacity-5" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,255,255,0.03) 20px, rgba(255,255,255,0.03) 40px);"></div>
                                    <!-- City skyline silhouette -->
                                    <div class="absolute bottom-0 left-0 right-0 h-32 opacity-3">
                                        <svg viewBox="0 0 400 100" class="w-full h-full" preserveAspectRatio="none">
                                            <path d="M0,100 L0,85 L15,82 L30,78 L45,75 L60,72 L75,70 L90,68 L105,66 L120,64 L135,62 L150,60 L165,58 L180,56 L195,54 L210,52 L225,50 L240,52 L255,54 L270,56 L285,58 L300,60 L315,62 L330,64 L345,66 L360,68 L375,70 L385,72 L400,75 L400,100 Z" fill="white"/>
                                        </svg>
                                    </div>
                                    <!-- Video play icon if video -->
                                    {% if hero_article._is_video %}
                                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20">
                                        <div class="bg-white/90 rounded-full p-4 shadow-2xl">
                                            <svg class="w-16 h-16 text-gray-900" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M8 5v14l11-7z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    {% endif %}
                                    <!-- Content overlay at bottom -->
                                    <div class="absolute bottom-0 left-0 right-0 p-6 lg:p-8 pb-12 lg:pb-16 bg-gradient-to-t from-black/95 via-black/70 to-transparent">
                                        <h2 class="text-2xl lg:text-3xl font-bold text-white mb-3 line-clamp-5 group-hover:text-blue-300 transition-colors leading-tight">
                                            {{ hero_article.title }}
                                        </h2>
                                        <div class="flex items-center gap-3 text-sm text-gray-200">
                                            <span class="font-medium">{{ hero_article.source_display }}</span>
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.formatted_date.split(' at ')[0] if ' at ' in hero_article.formatted_date else 'Recently' }}</span>
                                            {% if hero_article.reading_time %}
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.reading_time }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Navigation Arrows -->
                    {% if hero_articles|length > 1 %}
                    <button data-slider="prev" class="absolute left-4 top-1/2 transform -translate-y-1/2 z-30 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full p-3 transition-all duration-300 hover:scale-110" aria-label="Previous article">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button data-slider="next" class="absolute right-4 top-1/2 transform -translate-y-1/2 z-30 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full p-3 transition-all duration-300 hover:scale-110" aria-label="Next article">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                    {% endif %}
                    
                    <!-- Navigation Dots -->
                    {% if hero_articles|length > 1 %}
                    <div class="slider-dots absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 z-30">
                        {% for i in range(hero_articles|length) %}
                        <button data-slider-dot="{{ i }}" class="dot w-3 h-3 rounded-full {% if loop.first %}bg-white{% else %}bg-white/40{% endif %} hover:bg-white/60 transition-colors cursor-pointer"></button>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            
            <!-- Narrow Trending Sidebar (35% - 4 columns) -->
            <aside class="lg:col-span-4">
                <div class="rounded-xl p-6" style="background: rgba(16, 16, 16, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div class="flex items-center gap-2 mb-6">
                        <span class="text-2xl">üî•</span>
                        <h3 class="text-lg font-bold text-gray-100">Trending in {{ locale.split(',')[0] if ',' in locale else locale }}</h3>
                    </div>
                    <div class="space-y-4">
                        {% if trending_articles %}
                            {% for article in trending_articles[:8] %}
                            <a href="{{ article.url }}" target="_blank" rel="noopener" class="block group">
                                <div class="flex items-center gap-3 pb-2 border-b border-gray-800/30 last:border-0 -mx-2 px-2 rounded-lg transition-colors" onmouseover="this.style.background='rgba(26, 26, 26, 0.3)';" onmouseout="this.style.background='transparent';">
                                    {% if show_images and article.image_url and (article.image_url|default('')|trim) %}
                                    <div class="flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden bg-gradient-to-br from-[#161616] to-[#0f0f0f]">
                                        <img src="{{ article.image_url }}" alt="{{ article.title }}" loading="lazy" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">
                                    </div>
                                    {% else %}
                                    <div class="flex-shrink-0 w-16 h-16 rounded-lg bg-gradient-to-br {{ article.source_gradient }} flex items-center justify-center relative overflow-hidden">
                                        <div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,0.05) 5px, rgba(255,255,255,0.05) 10px);"></div>
                                        <div class="text-lg font-black text-white/90 drop-shadow-lg relative z-10">{{ article.source_initials }}</div>
                                    </div>
                                    {% endif %}
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-1 mb-1">
                                            <span class="text-sm">üî•</span>
                                            <h4 class="text-sm font-semibold text-gray-100 group-hover:text-orange-400 transition-colors line-clamp-2">{{ article.title }}</h4>
                                        </div>
                                        <div class="text-xs text-gray-500">{{ article.source_display }} ‚Ä¢ {{ article._trending_date if article._trending_date else (article.formatted_date.split(' at ')[0] if ' at ' in article.formatted_date else 'Recently') }}</div>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        {% else %}
                            <p class="text-gray-400 text-sm">No trending articles yet.</p>
                        {% endif %}
                    </div>
                </div>
            </aside>
        </div>
        
        <!-- Newest Articles Tile -->
        {% if newest_articles %}
        <div class="mb-8">
            <div class="bg-[#1a1a1a] rounded-xl p-6 border border-gray-800/30">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <span class="text-green-400">‚óè</span>
                    Newest Articles
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                    {% for article in newest_articles %}
                    <a href="{{ article.url }}" target="_blank" rel="noopener" class="group">
                        <div class="bg-[#0f0f0f] rounded-lg p-4 border border-gray-800/20 hover:border-blue-500/50 transition-all h-full flex flex-col">
                            {% if show_images and article.image_url and (article.image_url|default('')|trim) %}
                            <div class="aspect-square rounded-lg overflow-hidden mb-3 bg-gray-900">
                                <img src="{{ article.image_url }}" alt="{{ article.title }}" loading="lazy" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                            </div>
                            {% else %}
                            <div class="aspect-square rounded-lg mb-3 bg-gradient-to-br {{ article.source_gradient }} flex items-center justify-center relative overflow-hidden">
                                <div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,0.05) 5px, rgba(255,255,255,0.05) 10px);"></div>
                                <div class="text-2xl font-black text-white drop-shadow-lg relative z-10">{{ article.source_initials }}</div>
                            </div>
                            {% endif %}
                            <h3 class="text-sm font-semibold text-gray-100 line-clamp-2 mb-2 group-hover:text-blue-400 transition-colors">
                                {{ article.title }}
                            </h3>
                            <div class="text-xs text-gray-500 mt-auto">
                                {{ article.source_display }} ‚Ä¢ {{ article._trending_date if article._trending_date else (article.formatted_date if article.formatted_date else 'Recently') }}
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Perfect Masonry Grid Below Hero (3-4 columns) -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="articlesGrid">
            {% if articles and articles|length > 0 %}
                {% for article in articles[:30] %}
            <article class="group relative bg-[#161616]/40 backdrop-blur-sm rounded-xl overflow-hidden ring-1 ring-white/10 hover:ring-white/20 hover:shadow-2xl hover:shadow-blue-500/20 transition-all duration-300 hover:scale-[1.02] hover:-translate-y-1" data-category="{{ article.category }}" data-neighborhoods="{{ article.neighborhoods|join(',') if article.neighborhoods else '' }}">
                <a href="{{ article.url }}" target="_blank" rel="noopener" class="block">
                    {% if show_images and article.image_url and (article.image_url|default('')|trim) %}
                    <div class="relative aspect-square overflow-hidden rounded-t-xl">
                        <img src="{{ article.image_url }}" alt="{{ article.title }}" loading="lazy" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
                        <!-- Dark overlay gradient bottom 40% -->
                        <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent"></div>
                        <!-- Source badge in bottom-left -->
                        <div class="absolute bottom-3 left-3 px-2 py-1 rounded-full text-xs font-semibold text-white bg-black/60 backdrop-blur-sm border border-white/20">
                            {{ article.source_initials }}
                        </div>
                        <!-- Read time in bottom-right -->
                        {% if article.reading_time %}
                        <div class="absolute bottom-3 right-3 px-2 py-1 rounded-full text-xs font-medium text-white bg-black/60 backdrop-blur-sm border border-white/20">
                            {{ article.reading_time }}
                        </div>
                        {% endif %}
                        <!-- Title overlay -->
                        <div class="absolute bottom-0 left-0 right-0 p-4">
                            <h2 class="text-lg font-bold text-white mb-1 line-clamp-2 leading-tight">
                                {{ article.title }}
                            </h2>
                            <div class="text-xs text-gray-300">
                                {{ article.formatted_date.split(' at ')[0] if ' at ' in article.formatted_date else 'Recently' }}
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <!-- Placeholder with gradient background -->
                    <div class="relative aspect-square overflow-hidden rounded-t-xl bg-gradient-to-br {{ article.source_gradient }}">
                        <!-- Subtle pattern overlay for texture -->
                        <div class="absolute inset-0 opacity-10 bg-[repeating-linear-gradient(45deg,transparent,transparent_20px,rgba(255,255,255,0.03)_20px,rgba(255,255,255,0.03)_40px)]"></div>
                        <!-- Image placeholder icon centered -->
                        <div class="absolute inset-0 flex items-center justify-center">
                            <svg class="w-16 h-16 text-white/40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <!-- Dark overlay gradient bottom 40% -->
                        <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent"></div>
                        <!-- Source badge in bottom-left -->
                        <div class="absolute bottom-3 left-3 px-2 py-1 rounded-full text-xs font-semibold text-white bg-black/60 backdrop-blur-sm border border-white/20">
                            {{ article.source_initials }}
                        </div>
                        <!-- Read time in bottom-right -->
                        {% if article.reading_time %}
                        <div class="absolute bottom-3 right-3 px-2 py-1 rounded-full text-xs font-medium text-white bg-black/60 backdrop-blur-sm border border-white/20">
                            {{ article.reading_time }}
                        </div>
                        {% endif %}
                        <!-- Title overlay -->
                        <div class="absolute bottom-0 left-0 right-0 p-4">
                            <h2 class="text-lg font-bold text-white mb-1 line-clamp-2 leading-tight">
                                {{ article.title }}
                            </h2>
                            <div class="text-xs text-gray-300">
                                {{ article.formatted_date.split(' at ')[0] if ' at ' in article.formatted_date else 'Recently' }}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </a>
            </article>
                {% endfor %}
            {% else %}
            <div class="col-span-full text-center py-12">
                <p class="text-gray-400">No articles found. Check back soon!</p>
            </div>
            {% endif %}
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="bg-[#0a0a0a] border-t border-gray-900/30 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div>
                    <h4 class="text-lg font-bold text-gray-100 mb-3">Stay Informed</h4>
                    <p class="text-gray-400 text-sm mb-4">Get daily news updates delivered to your inbox.</p>
                    <form class="flex flex-col sm:flex-row gap-2" id="newsletterForm" onsubmit="handleNewsletterSignup(event)">
                        <input type="email" placeholder="Enter your email" class="flex-1 text-gray-100 rounded-lg px-4 py-2 text-sm focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 outline-none bg-[#161616]/60 backdrop-blur-sm border border-white/10" id="newsletterEmail" required>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg text-sm font-semibold transition-colors">Subscribe</button>
                    </form>
                    <div class="text-sm mt-2 min-h-[1.2rem]" id="newsletterMessage"></div>
                </div>
                <div>
                    <h4 class="text-lg font-bold text-gray-100 mb-3">Quick Links</h4>
                    <ul class="space-y-2">
                        <li><a href="index.html" class="text-gray-400 hover:text-blue-400 transition-colors text-sm">Local</a></li>
                    </ul>
                </div>
            </div>
            <div class="pt-6 border-t border-gray-900/30 text-center">
                <p class="text-gray-500 text-sm">&copy; {{ current_year }} {{ locale }} News Aggregator. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Mobile Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-[#0a0a0a]/95 backdrop-blur-md border-t border-gray-900/30 px-4 py-2 flex justify-around items-center z-50 lg:hidden">
        <a href="index.html" class="flex flex-col items-center gap-1 text-gray-400 hover:text-blue-400 transition-colors py-2 px-4 rounded-lg min-h-[44px] min-w-[44px]">
            <span class="text-xl">üìç</span>
            <span class="text-xs">Local</span>
        </a>
        <a href="{{ weather_station_url }}" target="_blank" rel="noopener" class="flex flex-col items-center gap-1 text-gray-400 hover:text-blue-400 transition-colors py-2 px-4 rounded-lg min-h-[44px] min-w-[44px]">
            <span class="text-xl">{{ weather_icon }}</span>
            <span class="text-xs">Weather</span>
        </a>
    </nav>
    
    <!-- Back to Top Button -->
    <button class="fixed bottom-20 right-6 bg-blue-500 hover:bg-blue-600 text-white w-12 h-12 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 hidden lg:block z-40" id="backToTop" onclick="scrollToTop()" title="Back to top">‚Üë</button>
    
    <script>
        // Set weather API key for frontend before weather.js loads
        window.WEATHER_API_KEY = '{{ weather_api_key }}';
    </script>
    <!-- Load scripts in dependency order -->
    <script src="js/storage.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="js/categorizer.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="js/news-fetcher.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="js/article-renderer.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="js/weather.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="js/tabs.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="js/stats.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="js/main.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script src="js/zip-router.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}"></script>
    <script>console.log('[FRNA] ‚úÖ Page loaded with cache-busting - build:', '{{ current_time }}');</script>
    <script>
        // Lazy image loading
        document.addEventListener('DOMContentLoaded', function() {
            const images = document.querySelectorAll('img[data-src]');
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.classList.add('loaded');
                        observer.unobserve(img);
                    }
                });
            });
            images.forEach(img => imageObserver.observe(img));
        });
    </script>
    
    <!-- Generation Timestamp Badge (Bottom-Right) -->
    <div class="fixed bottom-4 right-4 z-50 text-gray-500 px-3 py-1.5 rounded-lg text-xs font-mono shadow-lg bg-[#161616]/60 backdrop-blur-sm border border-white/5">
        <div>Generated: {{ generation_timestamp or "TEMPLATE_NOT_WORKING" }}</div>
        {% if last_db_update %}<div>DB Updated: {{ last_db_update }}</div>{% else %}<div>DB Updated: TEMPLATE_NOT_WORKING</div>{% endif %}
    </div>
</body>
</html>