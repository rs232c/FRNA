<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <meta name="description" content="{{ description }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Image display controlled by admin setting: show_images = {{ show_images }}

        document.addEventListener('DOMContentLoaded', function() {
            // Kill all images if disabled in localStorage
            if (localStorage.getItem('showImages') === 'false') {
                document.body.classList.add('no-images');
            }

            // Debug: Check for any images after 1 second
            setTimeout(() => {
                const allImages = document.querySelectorAll('img');
                const visibleImages = Array.from(allImages).filter(img => {
                    const rect = img.getBoundingClientRect();
                    return rect.width > 0 && rect.height > 0 && img.offsetParent !== null;
                });

                console.log('[IMAGE DEBUG] Total img tags found:', allImages.length);
                console.log('[IMAGE DEBUG] Visible images found:', visibleImages.length);
                console.log('[IMAGE DEBUG] body has no-images class:', document.body.classList.contains('no-images'));
                console.log('[IMAGE DEBUG] localStorage showImages:', localStorage.getItem('showImages'));

                if (visibleImages.length > 0) {
                    console.log('[IMAGE DEBUG] Visible image sources:');
                    visibleImages.forEach((img, i) => {
                        console.log(`  ${i+1}: ${img.src} (${img.offsetWidth}x${img.offsetHeight})`);
                    });
                }
            }, 1000);

            imgTags.forEach((img, index) => {
                console.log(`[IMAGE DEBUG] Image ${index + 1}: ${img.src}`);
                img.addEventListener('load', () => console.log(`[IMAGE DEBUG] Image ${index + 1} loaded successfully`));
                img.addEventListener('error', () => console.log(`[IMAGE DEBUG] Image ${index + 1} failed to load`));
            });
        });

        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'edge-bg': '#0d0d0d',
                        'edge-surface': '#161616',
                        'edge-elevated': '#1f1f1f',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/style.css?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}">
    <style>
        /* Custom styles for things Tailwind can't handle */
        .lazy-image { opacity: 0; transition: opacity 0.3s; }
        .lazy-image.loaded { opacity: 1; }

        /* Kill images when disabled - only hide actual img tags */
        body.no-images img {
          display: none !important;
        }

        /* Prevent FOUC - hide content until JS loads */
        .fouc-hidden { opacity: 0; transition: opacity 0.3s; }
        .fouc-hidden.loaded { opacity: 1; }

        /* Ensure dark theme is applied immediately */
        html.dark body { background: #0a0a0a !important; color: #ffffff !important; }

        /* Enhanced FOUC prevention - hide everything until ready */
        html {
            visibility: hidden;
            opacity: 0;
        }

        html.loaded {
            visibility: visible;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        /* Layout stability - prevent layout shift with aspect ratios */
        .article-image {
            aspect-ratio: 4/3;
            width: 100%;
            height: auto;
            object-fit: cover;
        }

        /* Premium loading states */
        .loading-shimmer {
            background: linear-gradient(90deg, transparent 25%, rgba(255,255,255,0.1) 50%, transparent 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        /* Premium animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.8), 0 0 40px rgba(59, 130, 246, 0.4); }
        }

        /* Premium micro-interactions */
        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        .animate-slide-in-right {
            animation: slideInRight 0.4s ease-out forwards;
        }

        .animate-pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        /* Premium skeleton loader */
        .skeleton-card {
            background: linear-gradient(90deg, #161616 25%, #1a1a1a 50%, #161616 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        /* Enhanced glassmorphism utility classes */
        .glass-subtle {
            background: rgba(22, 22, 22, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow:
                0 8px 32px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.1);
        }

        .glass-strong {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow:
                0 20px 40px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        /* Subtle depth with layered shadows */
        .depth-1 { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
        .depth-2 { box-shadow: 0 3px 6px rgba(0,0,0,0.15), 0 2px 4px rgba(0,0,0,0.12); }
        .depth-3 { box-shadow: 0 10px 20px rgba(0,0,0,0.15), 0 3px 6px rgba(0,0,0,0.10); }
        .depth-4 { box-shadow: 0 15px 25px rgba(0,0,0,0.15), 0 5px 10px rgba(0,0,0,0.05); }
        .depth-5 { box-shadow: 0 20px 40px rgba(0,0,0,0.2), 0 8px 16px rgba(0,0,0,0.1); }

        /* Enhanced mobile menu animations */
        #mobileMenu {
            transition: opacity 0.3s ease;
        }

        #mobileMenuPanel {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Premium focus states */
        .focus-ring:focus {
            outline: none;
            ring: 2px;
            ring-color: rgba(59, 130, 246, 0.5);
            ring-offset: 2px;
        }
    </style>
</head>
<body class="bg-[#0a0a0a] font-sans text-white/90 min-h-screen fouc-hidden">
    <!-- Sticky Navigation Bar (Header + Nav together) - becomes fixed on scroll -->
    <div class="sticky top-0 z-[999] bg-[#0a0a0a]/80 backdrop-blur-xl border-b border-gray-900/30 shadow-lg transition-all duration-300" id="headerNav">
        <header class="py-4">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- Perfect Single Row Layout: Badge Left | Search Center | Controls Right -->
                <div class="flex items-center justify-between min-h-[64px] gap-6">
                    <!-- Left: Location Badge -->
                    <div class="flex items-center px-4 py-2.5 rounded-full text-sm font-semibold shadow-lg bg-purple-500/20 backdrop-blur-xl border border-white/10 flex-shrink-0 hover:bg-purple-500/30 transition-all duration-300 hover:scale-105">
                        <span class="text-purple-300 mr-2">üìç</span>
                        <span class="text-white">{{ location_badge_text }}</span>
                    </div>

                    <!-- Center: Enhanced Search Bar -->
                    <div class="flex-1 max-w-2xl mx-6">
                        <div class="relative group">
                            <!-- Subtle background glow on focus -->
                            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/10 via-purple-500/10 to-blue-500/10 rounded-full blur-lg opacity-0 group-focus-within:opacity-100 transition-all duration-300"></div>
                            <div class="relative bg-[#161616]/80 backdrop-blur-xl rounded-full px-6 py-3 border border-white/10 focus-within:border-blue-400/50 focus-within:ring-2 focus-within:ring-blue-400/20 transition-all duration-300 hover:border-white/20">
                                <div class="flex items-center">
                                    <span class="text-gray-400 mr-3 text-lg">üîç</span>
                                    <input type="text" placeholder="Search Fall River news..." class="bg-transparent border-none outline-none text-white placeholder-gray-400 flex-1 w-full text-sm" id="searchInput">
                                    <button type="button" class="text-gray-400 hover:text-blue-400 transition-colors ml-3 p-2 rounded-full hover:bg-gray-800/50" onclick="toggleSearchFilters(); event.preventDefault();" title="Advanced Filters">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Premium Controls -->
                    <div class="flex items-center gap-3 flex-shrink-0">
                        <a href="{{ weather_station_url }}" target="_blank" rel="noopener" id="weatherPillHeader" class="flex items-center gap-2 rounded-xl px-4 py-2.5 bg-blue-500/20 backdrop-blur-xl border border-white/10 hover:bg-blue-500/30 transition-all duration-300 hover:scale-105">
                            <span id="weatherIconHeader" class="text-lg">üå§Ô∏è</span>
                            <div class="text-white hidden sm:block">
                                <div id="weatherTempHeader" class="font-bold text-sm leading-tight">--¬∞F</div>
                                <div id="weatherConditionHeader" class="text-blue-200 text-xs">Clear</div>
                            </div>
                        </a>
                        <button id="mobileNavToggle" class="text-gray-400 hover:text-white transition-colors p-3 rounded-xl hover:bg-[#161616]/50" aria-label="Toggle navigation menu" title="Menu & Category Controls">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-[#0a0a0a]/80 backdrop-blur-md border-b border-gray-900/20 py-2">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                    <div class="text-xl font-semibold text-blue-400">FRNA</div>
                    {{ nav_tabs }}
                </div>
            </div>
        </nav>

        <!-- Advanced Search Filters -->
                <div class="hidden w-full max-w-6xl mx-auto" id="searchFilters">
                    <div class="p-6 rounded-xl bg-[#161616]/60 backdrop-blur-sm border border-white/10 shadow-xl">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Category:</label>
                                <select id="filterCategory" class="w-full text-gray-100 rounded-lg px-3 py-2 text-sm focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 bg-[#161616]/60 backdrop-blur-sm border border-white/10">
                                    <option value="">All Categories</option>
                                    <option value="news">üì∞ News</option>
                                    <option value="entertainment">üé¨ Entertainment</option>
                                    <option value="sports">‚öΩ Sports</option>
                                    <option value="local">üìç Local</option>
                                    <option value="media">üé• Media</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Neighborhood:</label>
                                <select id="filterNeighborhood" class="w-full text-gray-100 rounded-lg px-3 py-2 text-sm focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 bg-[#161616]/60 backdrop-blur-sm border border-white/10">
                                    <option value="">All Neighborhoods</option>
                                    <option value="north end">North End</option>
                                    <option value="south end">South End</option>
                                    <option value="highlands">Highlands</option>
                                    <option value="flint village">Flint Village</option>
                                    <option value="maplewood">Maplewood</option>
                                    <option value="downtown">Downtown</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Source:</label>
                                <select id="filterSource" class="w-full text-gray-100 rounded-lg px-3 py-2 text-sm focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 bg-[#161616]/60 backdrop-blur-sm border border-white/10">
                                    <option value="">All Sources</option>
                                    {% for source in sources %}
                                    <option value="{{ source }}">{{ source }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date Range:</label>
                                <select id="filterDateRange" class="w-full text-gray-100 rounded-lg px-3 py-2 text-sm focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 bg-[#161616]/60 backdrop-blur-sm border border-white/10">
                                    <option value="">All Time</option>
                                    <option value="today">Today</option>
                                    <option value="week">Last 7 Days</option>
                                    <option value="month">Last 30 Days</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button class="w-full text-gray-100 px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-[#161616]/60 backdrop-blur-sm border border-white/10 hover:bg-[#1a1a1a]/70 hover:border-white/20" onclick="clearFilters()">Clear Filters</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    </div>

    <!-- Premium Mobile Menu Drawer -->
    <div id="mobileMenu" class="fixed inset-0 z-[9999] bg-black/50 backdrop-blur-md hidden opacity-0 transition-opacity duration-300">
        <!-- Enhanced backdrop with animation -->
        <div class="absolute inset-0 bg-gradient-to-r from-black/60 via-black/40 to-transparent" onclick="closeMobileMenu()"></div>

        <!-- Premium drawer panel with enhanced animations -->
        <div class="absolute top-0 right-0 h-full w-80 bg-[#0a0a0a]/95 backdrop-blur-2xl border-l border-white/10 shadow-2xl transform translate-x-full transition-all duration-500 ease-out" id="mobileMenuPanel">
            <!-- Premium header -->
            <div class="flex items-center justify-between p-6 border-b border-white/10 bg-gradient-to-r from-purple-500/10 to-blue-500/10">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-blue-500 flex items-center justify-center">
                        <span class="text-white font-bold text-sm">F</span>
                    </div>
                    <h2 class="text-xl font-bold bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent">Fall River</h2>
                </div>
                <button id="closeMobileMenu" class="text-gray-400 hover:text-white transition-all duration-300 p-3 rounded-xl hover:bg-white/10 hover:scale-110">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Enhanced categories section -->
            <div class="px-6 py-6 overflow-y-auto h-full pb-24">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-300 mb-4 flex items-center gap-2">
                        <span class="w-1 h-4 bg-gradient-to-b from-blue-400 to-purple-400 rounded-full"></span>
                        Category Controls
                    </h3>
                    <p class="text-sm text-gray-500 mb-4">Toggle categories on/off to customize your feed</p>
                </div>
                <div class="space-y-2 animate-slide-in-right">
                    <!-- Local - Always Enabled (Essential) -->
                    <div class="group flex items-center justify-between p-1 rounded-xl bg-gradient-to-r from-gray-600/20 to-gray-500/10 transition-all duration-300">
                        <a href="/" class="flex-1 px-4 py-2 rounded-lg transition-all duration-300 text-gray-300/80 font-semibold text-left">
                            Local News
                        </a>
                        <div class="ml-4 flex items-center">
                            <div class="w-12 h-6 bg-blue-500/30 rounded-full flex items-center justify-end px-1 shadow-inner opacity-60">
                                <div class="w-5 h-5 bg-blue-400/40 rounded-full shadow-md"></div>
                            </div>
                        </div>
                    </div>
                    <!-- Police & Fire -->
                    <div class="group flex items-center justify-between p-1 rounded-xl hover:bg-gray-800/20 transition-all duration-300">
                        <a href="/category/police-fire" class="flex-1 px-4 py-2 rounded-lg transition-all duration-300 text-gray-300 hover:text-white font-semibold border border-transparent hover:border-red-500/30 hover:bg-red-500/10 text-left" id="link-crime">
                            Police & Fire
                        </a>
                        <label class="ml-4 relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" id="toggle-crime" checked>
                            <div class="w-12 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-400/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-gray-700 after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-500 peer-checked:after:bg-white shadow-inner"></div>
                        </label>
                    </div>
                    <!-- Sports -->
                    <div class="group flex items-center justify-between p-1 rounded-xl hover:bg-gray-800/20 transition-all duration-300">
                        <a href="/category/sports" class="flex-1 px-4 py-2 rounded-lg transition-all duration-300 text-gray-300 hover:text-white font-semibold border border-transparent hover:border-green-500/30 hover:bg-green-500/10 text-left" id="link-sports">
                            Sports
                        </a>
                        <label class="ml-4 relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" id="toggle-sports" checked>
                            <div class="w-12 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-400/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-gray-700 after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500 peer-checked:after:bg-white shadow-inner"></div>
                        </label>
                    </div>
                    <!-- Obituaries -->
                    <div class="group flex items-center justify-between p-1 rounded-xl hover:bg-gray-800/20 transition-all duration-300">
                        <a href="/category/obituaries" class="flex-1 px-4 py-2 rounded-lg transition-all duration-300 text-gray-300 hover:text-white font-semibold border border-transparent hover:border-purple-500/30 hover:bg-purple-500/10 text-left" id="link-obituaries">
                            Obituaries
                        </a>
                        <label class="ml-4 relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" id="toggle-obituaries" checked>
                            <div class="w-12 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-400/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-gray-700 after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-500 peer-checked:after:bg-white shadow-inner"></div>
                        </label>
                    </div>
                    <!-- Food & Drink -->
                    <div class="group flex items-center justify-between p-1 rounded-xl hover:bg-gray-800/20 transition-all duration-300">
                        <a href="/category/food" class="flex-1 px-4 py-2 rounded-lg transition-all duration-300 text-gray-300 hover:text-white font-semibold border border-transparent hover:border-orange-500/30 hover:bg-orange-500/10 text-left" id="link-food">
                            Food & Drink
                        </a>
                        <label class="ml-4 relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" id="toggle-food" checked>
                            <div class="w-12 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-400/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-gray-700 after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500 peer-checked:after:bg-white shadow-inner"></div>
                        </label>
                    </div>

                    <!-- Scanner -->
                    <div class="group flex items-center justify-between p-1 rounded-xl hover:bg-gray-800/20 transition-all duration-300">
                        <a href="/category/scanner" class="flex-1 px-4 py-2 rounded-lg transition-all duration-200 text-gray-300 hover:text-white font-semibold border border-transparent hover:border-gray-700 hover:bg-gray-900/30 text-left" id="link-scanner">
                            Scanner
                        </a>
                        <label class="ml-4 relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" id="toggle-scanner" checked>
                            <div class="w-12 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-gray-400 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-gray-700 after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-gray-700 peer-checked:after:bg-gray-600 shadow-inner"></div>
                        </label>
                    </div>
                    <!-- Meetings -->
                    <div class="group flex items-center justify-between p-1 rounded-xl hover:bg-gray-800/20 transition-all duration-300">
                        <a href="/category/meetings" class="flex-1 px-4 py-2 rounded-lg transition-all duration-200 text-gray-300 hover:text-white font-semibold border border-transparent hover:border-gray-700 hover:bg-gray-900/30 text-left" id="link-meetings">
                            Meetings
                        </a>
                        <label class="ml-4 relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" id="toggle-meetings" checked>
                            <div class="w-12 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-gray-400 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-gray-700 after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-gray-700 peer-checked:after:bg-gray-600 shadow-inner"></div>
                        </label>
                    </div>
                    <!-- Events -->
                    <div class="group flex items-center justify-between p-1 rounded-xl hover:bg-gray-800/20 transition-all duration-300">
                        <a href="/category/events" class="flex-1 px-4 py-2 rounded-lg transition-all duration-200 text-gray-300 hover:text-white font-semibold border border-transparent hover:border-gray-700 hover:bg-gray-900/30 text-left" id="link-events">
                            Events
                        </a>
                        <label class="ml-4 relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" id="toggle-events" checked>
                            <div class="w-12 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-gray-400 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-gray-700 after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-gray-700 peer-checked:after:bg-gray-600 shadow-inner"></div>
                        </label>
                    </div>

                    <!-- Image Display Toggle -->
                    {% if show_images %}
                    <div class="mt-6 px-1">
                        <div class="mb-4">
                            <h4 class="text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2">
                                <span class="w-1 h-3 bg-gradient-to-b from-cyan-400 to-blue-400 rounded-full"></span>
                                Display Settings
                            </h4>
                        </div>
                        <div class="group flex items-center justify-between p-1 rounded-xl hover:bg-gray-800/20 transition-all duration-300">
                            <div class="flex-1 px-4 py-2 rounded-lg transition-all duration-300 text-gray-300 hover:text-white font-semibold text-left">
                                Show Images
                            </div>
                            <label class="ml-4 relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" id="toggle-images" {% if show_images %}checked{% endif %}>
                                <div class="w-12 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-cyan-400/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-gray-700 after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-500 peer-checked:after:bg-white shadow-inner"></div>
                            </label>
                        </div>
                    </div>
                    {% else %}
                    <div class="mt-6 px-1">
                        <div class="mb-4">
                            <h4 class="text-sm font-semibold text-gray-500 mb-3 flex items-center gap-2">
                                <span class="w-1 h-3 bg-gradient-to-b from-gray-500 to-gray-600 rounded-full"></span>
                                Display Settings
                            </h4>
                        </div>
                        <div class="group flex items-center justify-between p-1 rounded-xl bg-gray-800/10 transition-all duration-300 opacity-60 cursor-not-allowed">
                            <div class="flex-1 px-4 py-2 rounded-lg transition-all duration-300 text-gray-500 font-semibold text-left">
                                Show Images (Disabled by Admin)
                            </div>
                            <label class="ml-4 relative inline-flex items-center cursor-not-allowed">
                                <input type="checkbox" class="sr-only peer" id="toggle-images" disabled>
                                <div class="w-12 h-6 bg-gray-600 rounded-full flex items-center justify-start px-1 shadow-inner opacity-50 cursor-not-allowed">
                                    <div class="w-5 h-5 bg-gray-500 rounded-full shadow-md"></div>
                                </div>
                            </label>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Subtle Admin Link -->
                    <div class="mt-6 pt-4 border-t border-gray-800/30">
                        <a href="/admin/02720?tab=articles" class="block text-center text-xs text-gray-500 hover:text-gray-400 transition-colors py-2 px-4 rounded-lg hover:bg-gray-800/20" title="Admin Panel">
                            ‚öôÔ∏è Admin Panel
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative">
        
        <!-- Hero + Trending Row (65/35 split) -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-10 items-start">
            <!-- Massive Hero Carousel (65% - 8 columns) -->
            <div class="lg:col-span-8">
                {% if hero_articles and hero_articles|length > 0 %}
                <div class="relative rounded-xl overflow-hidden shadow-2xl h-[400px] lg:h-[600px] hero-carousel-container" style="overflow: hidden;">
                    <!-- Carousel Container -->
                    <div class="top-stories-track h-full" style="display: flex; transition: transform 0.5s ease-in-out;">
                        {% for hero_article in hero_articles %}
                        <div class="story-slide flex-shrink-0 h-full relative" style="flex: 0 0 calc(100% / {{ hero_articles|length }}); width: calc(100% / {{ hero_articles|length }});">
                            <a href="{{ hero_article.url }}" target="_blank" rel="noopener" class="group block relative w-full h-full">
                                <!-- Image container - only when images enabled -->
                                {% if show_images and hero_article.image_url and (hero_article.image_url|default('')|trim) %}
                                <div class="relative h-full overflow-hidden image-container">
                                    {% if show_images %}
                                    <img src="{{ hero_article.image_url }}" alt="{{ hero_article.title }}" loading="lazy" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                                    {% else %}
                                    <div class="bg-gray-800 border-2 border-dashed border-gray-600 rounded-lg w-full h-full flex items-center justify-center">
                                        <span class="text-gray-500 text-sm">Images off</span>
                                    </div>
                                    {% endif %}
                                    <!-- Light gradient overlay bottom 40% to show source gradients -->
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent" style="background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.2) 40%, transparent 100%);"></div>
                                    <!-- Video play icon if video -->
                                    {% if hero_article._is_video %}
                                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20">
                                        <div class="bg-white/90 rounded-full p-4 shadow-2xl">
                                            <svg class="w-16 h-16 text-gray-900" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M8 5v14l11-7z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    {% endif %}
                                    <!-- Content overlay at bottom -->
                                    <div class="absolute bottom-0 left-0 right-0 p-6 lg:p-8 pb-12 lg:pb-16">
                                        <h2 class="font-bold text-2xl mb-3 line-clamp-5 group-hover:text-blue-300 transition-colors leading-tight">
                                            {{ hero_article.title }}
                                        </h2>
                                        <div class="flex items-center gap-3 text-sm text-gray-200">
                                            <span class="font-medium">{{ hero_article.source_display }}</span>
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.formatted_date.split(' at ')[0] if ' at ' in hero_article.formatted_date else 'Recently' }}</span>
                                            {% if hero_article.reading_time %}
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.reading_time }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <!-- Placeholder container - only when images disabled -->
                                <div class="relative h-full overflow-hidden bg-gradient-to-br {{ hero_article.source_gradient or 'from-purple-500 to-blue-600' }} placeholder-container">
                                    <!-- Subtle pattern overlay -->
                                    <div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,255,255,0.05) 20px, rgba(255,255,255,0.05) 40px);"></div>
                                    <!-- Video play icon if video -->
                                    {% if hero_article._is_video %}
                                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20">
                                        <div class="bg-white/90 rounded-full p-4 shadow-2xl">
                                            <svg class="w-16 h-16 text-gray-900" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M8 5v14l11-7z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    {% endif %}
                                    <!-- Content overlay at bottom -->
                                    <div class="absolute bottom-0 left-0 right-0 p-6 lg:p-8 pb-12 lg:pb-16 bg-gradient-to-t from-black/95 via-black/70 to-transparent">
                                        <h2 class="font-bold text-2xl mb-3 line-clamp-5 group-hover:text-blue-300 transition-colors leading-tight">
                                            {{ hero_article.title }}
                                        </h2>
                                        <div class="flex items-center gap-3 text-sm text-gray-200">
                                            <span class="font-medium">{{ hero_article.source_display }}</span>
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.formatted_date.split(' at ')[0] if ' at ' in hero_article.formatted_date else 'Recently' }}</span>
                                            {% if hero_article.reading_time %}
                                            <span>‚Ä¢</span>
                                            <span>{{ hero_article.reading_time }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                            </a>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Navigation Arrows -->
                    {% if hero_articles|length > 1 %}
                    <button data-slider="prev" class="absolute left-4 top-1/2 transform -translate-y-1/2 z-30 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full p-3 transition-all duration-300 hover:scale-110" aria-label="Previous article">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button data-slider="next" class="absolute right-4 top-1/2 transform -translate-y-1/2 z-30 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full p-3 transition-all duration-300 hover:scale-110" aria-label="Next article">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                    {% endif %}
                    
                    <!-- Navigation Dots -->
                    {% if hero_articles|length > 1 %}
                    <div class="slider-dots absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 z-30">
                        {% for i in range(hero_articles|length) %}
                        <button data-slider-dot="{{ i }}" class="dot w-3 h-3 rounded-full {% if loop.first %}bg-white{% else %}bg-white/40{% endif %} hover:bg-white/60 transition-colors cursor-pointer"></button>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            
            <!-- Narrow Trending Sidebar (35% - 4 columns) -->
            <aside class="lg:col-span-4">
                <div class="rounded-xl p-6" style="background: rgba(16, 16, 16, 0.4); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div class="text-center mb-6">
                        <div class="flex items-center justify-center gap-2 mb-2">
                            <span class="text-2xl">üî•</span>
                            <h3 class="font-bold text-xl text-gray-100">Trending in Fall River</h3>
                        </div>
                        <div class="w-16 h-0.5 bg-gradient-to-r from-transparent via-orange-500 to-transparent mx-auto"></div>
                    </div>
                    <div class="space-y-4">
                        {% if trending_articles %}
                            {% for article in trending_articles[:8] %}
                            <a href="{{ article.url }}" target="_blank" rel="noopener" class="block group">
                                <div class="flex items-start gap-3 pb-3 border-b border-gray-800/30 last:border-0 -mx-2 px-2 rounded-lg transition-colors hover:bg-gray-800/20">
                                    <!-- Image container - only when images enabled -->
                                    {% if show_images and article.image_url and (article.image_url|default('')|trim) %}
                                    <div class="flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden bg-gradient-to-br from-[#161616] to-[#0f0f0f] image-container">
                                        {% if show_images %}
                                        <img src="{{ article.image_url }}" alt="{{ article.title }}" loading="lazy" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">
                                        {% else %}
                                        <div class="bg-gray-800 border-2 border-dashed border-gray-600 rounded-lg w-full h-full flex items-center justify-center">
                                            <span class="text-gray-500 text-sm">Images off</span>
                                        </div>
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                    <!-- Placeholder container - only when images disabled -->
                                    {% if not (show_images and article.image_url and (article.image_url|default('')|trim)) %}
                                    <div class="flex-shrink-0 w-16 h-16 rounded-lg bg-gradient-to-br {{ article.source_gradient }} flex items-center justify-center relative overflow-hidden placeholder-container">
                                        <div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,0.05) 5px, rgba(255,255,255,0.05) 10px);"></div>
                                        <div class="text-lg font-black text-white/90 drop-shadow-lg relative z-10">{{ article.source_initials }}</div>
                                    </div>
                                    {% endif %}
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-start gap-1.5 mb-1">
                                            <span class="text-orange-500 text-xs mt-0.5 flex-shrink-0">üî•</span>
                                            <h4 class="text-sm font-semibold text-gray-100 group-hover:text-orange-400 transition-colors line-clamp-2 leading-snug">{{ article.title }}</h4>
                                        </div>
                                        <div class="text-xs text-gray-500 ml-4">{{ article.source_display }} ‚Ä¢ {{ article._trending_date if article._trending_date else (article.formatted_date.split(' at ')[0] if ' at ' in article.formatted_date else 'Recently') }}</div>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        {% else %}
                            <!-- Skeleton loader for trending articles -->
                            {% for i in range(5) %}
                            <div class="flex items-start gap-3 pb-3 border-b border-gray-800/30 last:border-0 -mx-2 px-2 animate-pulse">
                                <div class="flex-shrink-0 w-16 h-16 rounded-lg bg-gray-700"></div>
                                <div class="flex-1 min-w-0">
                                    <div class="h-4 bg-gray-700 rounded mb-2"></div>
                                    <div class="h-3 bg-gray-800 rounded w-3/4"></div>
                                </div>
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </aside>
        </div>
        
        <!-- Premium Newest Articles Section -->
        {% if newest_articles %}
        <div class="mb-12">
            <div class="bg-[#161616]/80 backdrop-blur-xl rounded-2xl p-8 border border-white/10 shadow-2xl">
                <h2 class="font-bold text-3xl mb-6 flex items-center gap-3">
                    <span class="text-green-400 text-xl animate-pulse">‚óè</span>
                    <span class="bg-gradient-to-r from-green-400 to-blue-400 bg-clip-text text-transparent">Newest Articles</span>
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
                    {% for article in newest_articles[:4] %}
                    <a href="{{ article.url }}" target="_blank" rel="noopener" class="group animate-fade-in-up" style="animation-delay: {{ loop.index * 0.15 }}s;">
                        <div class="bg-[#1a1a1a]/60 backdrop-blur-sm rounded-xl overflow-hidden border border-white/5 hover:border-blue-400/30 transition-all duration-500 h-full flex flex-col hover:scale-[1.02] hover:-translate-y-1 hover:shadow-xl hover:shadow-blue-500/10">
                            <!-- Image container - only when images enabled -->
                            {% if show_images and article.image_url and (article.image_url|default('')|trim) %}
                            <div class="aspect-[4/3] rounded-t-xl overflow-hidden bg-gray-900 image-container">
                                {% if show_images %}
                                <img src="{{ article.image_url }}" alt="{{ article.title }}" loading="lazy" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" style="aspect-ratio: 4/3;">
                                {% else %}
                                <div class="bg-gray-800 border-2 border-dashed border-gray-600 rounded-lg w-full h-full flex items-center justify-center" style="aspect-ratio: 4/3;">
                                    <span class="text-gray-500 text-sm">Images off</span>
                                </div>
                                {% endif %}
                                <!-- Subtle overlay -->
                                <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            </div>
                            {% else %}
                            <!-- Placeholder container - only when images disabled -->
                            <div class="aspect-[4/3] rounded-t-xl bg-gradient-to-br {{ article.source_gradient or 'from-green-500/20 via-blue-500/20 to-purple-500/20' }} flex items-center justify-center relative overflow-hidden placeholder-container">
                                <div class="absolute inset-0 opacity-10 bg-[repeating-linear-gradient(45deg,transparent,transparent_10px,rgba(255,255,255,0.03)_10px,rgba(255,255,255,0.03)_20px)]"></div>
                                <div class="text-4xl font-black text-white/40 drop-shadow-lg relative z-10">{{ article.source_initials }}</div>
                            </div>
                            {% endif %}
                            <div class="p-5 flex flex-col flex-1">
                                <h3 class="text-base font-semibold text-gray-100 line-clamp-2 mb-3 group-hover:text-blue-400 transition-colors duration-300 leading-snug">
                                    {{ article.title }}
                                </h3>
                                <div class="text-sm text-gray-400 mt-auto flex items-center gap-2">
                                    <span class="text-xs px-2 py-1 rounded-full bg-white/5 text-gray-300">{{ article.source_display }}</span>
                                    <span class="text-gray-500">‚Ä¢</span>
                                    <span>{{ article._trending_date if article._trending_date else (article.formatted_date.split(' at ')[0] if ' at ' in article.formatted_date else (article.formatted_date if article.formatted_date else 'Recently')) }}</span>
                                </div>
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Premium Article Grid (4:3 aspect ratio for better content display) -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" id="articlesGrid">
            {% if articles and articles|length > 0 %}
                {% for article in articles[:30] %}
            <article class="group relative bg-[#161616]/60 backdrop-blur-sm rounded-2xl overflow-hidden ring-1 ring-white/5 hover:ring-white/20 hover:shadow-2xl hover:shadow-blue-500/10 transition-all duration-500 hover:scale-[1.02] hover:-translate-y-2 animate-fade-in-up" data-category="{{ article.category }}" data-neighborhoods="{{ article.neighborhoods|join(',') if article.neighborhoods else '' }}" style="animation-delay: {{ loop.index * 0.1 }}s;">
                <a href="{{ article.url }}" target="_blank" rel="noopener" class="block">
                    <!-- Image container - only when images enabled -->
                    {% if show_images and article.image_url and (article.image_url|default('')|trim) %}
                    <div class="relative aspect-[4/3] overflow-hidden rounded-t-2xl bg-gradient-to-br {{ article.source_gradient or 'from-gray-600 to-gray-700' }} image-container">
                        {% if show_images %}
                        <img src="{{ article.image_url }}" alt="{{ article.title }}" loading="lazy"
                             class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                             style="aspect-ratio: 4/3;">
                        {% else %}
                        <div class="bg-gray-800 border-2 border-dashed border-gray-600 rounded-lg w-full h-full flex items-center justify-center" style="aspect-ratio: 4/3;">
                            <span class="text-gray-500 text-sm">Images off</span>
                        </div>
                        {% endif %}
                        <!-- Premium gradient overlay - lighter to show source gradients -->
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 via-60% to-transparent opacity-40 group-hover:opacity-20 transition-opacity duration-500"></div>

                        <!-- Premium source badge -->
                        <div class="absolute top-3 left-3 px-3 py-1.5 rounded-full text-xs font-semibold text-white bg-gradient-to-r from-blue-500/90 to-purple-500/90 backdrop-blur-sm border border-white/20 shadow-lg">
                            {{ article.source_initials or 'XX' }}
                        </div>

                        <!-- Premium read time badge -->
                        {% if article.reading_time %}
                        <div class="absolute top-3 right-3 px-3 py-1.5 rounded-full text-xs font-medium text-white bg-black/70 backdrop-blur-sm border border-white/20 shadow-lg">
                            {{ article.reading_time }}
                        </div>
                        {% endif %}

                        <!-- Enhanced title overlay with better typography -->
                        <div class="absolute bottom-0 left-0 right-0 p-6">
                            <h2 class="font-bold text-xl mb-2 line-clamp-3 leading-tight text-white drop-shadow-lg group-hover:text-blue-200 transition-colors duration-300">
                                {{ article.title }}
                            </h2>
                            <div class="text-sm text-gray-200 drop-shadow-md">
                                {{ article.formatted_date.split(' at ')[0] if ' at ' in article.formatted_date else 'Recently' }}
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <!-- Placeholder container - only when images disabled -->
                    <div class="relative aspect-[4/3] overflow-hidden rounded-t-2xl bg-gradient-to-br {{ article.source_gradient or 'from-gray-600 to-gray-700' }} placeholder-container">
                        <!-- Subtle texture overlay -->
                        <div class="absolute inset-0 opacity-10 bg-[repeating-linear-gradient(45deg,transparent,transparent_20px,rgba(255,255,255,0.03)_20px,rgba(255,255,255,0.03)_40px)]"></div>

                        <!-- Premium icon placeholder -->
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="text-5xl font-black text-white/30 drop-shadow-2xl">{{ article.source_initials }}</div>
                        </div>

                        <!-- Premium gradient overlay -->
                        <div class="absolute inset-0 bg-gradient-to-t from-black/95 via-black/60 via-60% to-transparent opacity-80"></div>

                        <!-- Premium badges -->
                        <div class="absolute top-3 left-3 px-3 py-1.5 rounded-full text-xs font-semibold text-white bg-gradient-to-r from-blue-500/90 to-purple-500/90 backdrop-blur-sm border border-white/20 shadow-lg">
                            {{ article.source_initials }}
                        </div>
                        {% if article.reading_time %}
                        <div class="absolute top-3 right-3 px-3 py-1.5 rounded-full text-xs font-medium text-white bg-black/70 backdrop-blur-sm border border-white/20 shadow-lg">
                            {{ article.reading_time }}
                        </div>
                        {% endif %}

                        <!-- Enhanced title overlay -->
                        <div class="absolute bottom-0 left-0 right-0 p-6">
                            <h2 class="font-bold text-xl mb-2 line-clamp-3 leading-tight text-white drop-shadow-lg group-hover:text-blue-200 transition-colors duration-300">
                                {{ article.title }}
                            </h2>
                            <div class="text-sm text-gray-200 drop-shadow-md">
                                {{ article.formatted_date.split(' at ')[0] if ' at ' in article.formatted_date else 'Recently' }}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </a>
            </article>
                {% endfor %}
            {% else %}
            <!-- Skeleton loader for articles grid -->
            {% for i in range(12) %}
            <article class="group relative bg-[#161616]/40 backdrop-blur-sm rounded-xl overflow-hidden ring-1 ring-white/10 animate-pulse">
                <div class="relative aspect-square overflow-hidden rounded-t-xl bg-gray-700">
                    <div class="absolute bottom-0 left-0 right-0 p-4">
                        <div class="h-5 bg-gray-600 rounded mb-2"></div>
                        <div class="h-3 bg-gray-700 rounded w-2/3"></div>
                    </div>
                </div>
            </article>
            {% endfor %}
            {% endif %}
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="bg-[#0a0a0a] border-t border-gray-900/30 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div>
                    <h4 class="font-bold text-2xl mb-3">Stay Informed</h4>
                    <p class="text-gray-400 text-sm mb-4">Get daily news updates delivered to your inbox.</p>
                    <form class="flex flex-col sm:flex-row gap-2" id="newsletterForm" onsubmit="handleNewsletterSignup(event)">
                        <input type="email" placeholder="Enter your email" class="flex-1 text-gray-100 rounded-lg px-4 py-2 text-sm focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 outline-none bg-[#161616]/60 backdrop-blur-sm border border-white/10" id="newsletterEmail" required>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg text-sm font-semibold transition-colors">Subscribe</button>
                    </form>
                    <div class="text-sm mt-2 min-h-[1.2rem]" id="newsletterMessage"></div>
                </div>
                <div>
                    <h4 class="font-bold text-2xl mb-3">Quick Links</h4>
                    <ul class="space-y-2">
                        <li><a href="/" class="text-gray-400 hover:text-blue-400 transition-colors text-sm">Local</a></li>
                        <li><a href="/category/police-fire" class="text-gray-400 hover:text-blue-400 transition-colors text-sm">Police & Fire</a></li>
                        <li><a href="/category/sports" class="text-gray-400 hover:text-blue-400 transition-colors text-sm">Sports</a></li>
                        <li><a href="/category/obituaries" class="text-gray-400 hover:text-blue-400 transition-colors text-sm">Obituaries</a></li>
                        <li><a href="/category/food" class="text-gray-400 hover:text-blue-400 transition-colors text-sm">Food & Drink</a></li>
                        <li><a href="/category/entertainment" class="text-gray-400 hover:text-blue-400 transition-colors text-sm">Media</a></li>
                    </ul>
                </div>
            </div>
            <div class="pt-6 border-t border-gray-900/30 text-center">
                <p class="text-gray-500 text-sm">&copy; {{ current_year }} {{ locale }} News Aggregator. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Mobile Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-[#0a0a0a]/95 backdrop-blur-md border-t border-gray-900/30 px-4 py-2 flex justify-around items-center z-50 lg:hidden">
        <a href="/" class="flex flex-col items-center gap-1 text-gray-400 hover:text-blue-400 transition-colors py-2 px-4 rounded-lg min-h-[44px] min-w-[44px]">
            <span class="text-xl">üìç</span>
            <span class="text-xs">Local</span>
        </a>
        <a href="{{ weather_station_url }}" target="_blank" rel="noopener" class="flex flex-col items-center gap-1 text-gray-400 hover:text-blue-400 transition-colors py-2 px-4 rounded-lg min-h-[44px] min-w-[44px]">
            <span class="text-xl">{{ weather_icon }}</span>
            <span class="text-xs">Weather</span>
        </a>
    </nav>
    
    <!-- Back to Top Button -->
    <button class="fixed bottom-20 right-6 bg-blue-500 hover:bg-blue-600 text-white w-12 h-12 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 hidden lg:block z-40" id="backToTop" onclick="scrollToTop()" title="Back to top">‚Üë</button>
    
    <script>
        // Set weather API key for frontend before weather.js loads
        window.WEATHER_API_KEY = '{{ weather_api_key }}';
        
        // #region premium FOUC prevention
        // ENHANCED FOUC FIX - Premium loading experience
        (function() {
            function revealContent() {
                const html = document.documentElement;
                const body = document.body;

                // Remove loading classes and show content
                html.classList.add('loaded');
                if (body && body.classList.contains('fouc-hidden')) {
                    body.classList.add('loaded');
                }

                // Add premium loading complete class
                document.body.classList.add('premium-loaded');

                try {
                    fetch('http://127.0.0.1:7242/ingest/9497b7ee-78b4-45c5-99fd-3c5b05e85c0a', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            location: 'index.html.j2:revealContent',
                            message: 'Premium FOUC removed - content revealed with animations',
                            data: {readyState: document.readyState, timestamp: Date.now()},
                            timestamp: Date.now(),
                            sessionId: 'premium-session',
                            runId: 'premium-run1',
                            hypothesisId: 'PREMIUM'
                        })
                    }).catch(() => {});
                } catch(e) {}
            }

            // Multiple reveal triggers for robustness
            if (document.readyState === 'complete') {
                // DOM already loaded
                setTimeout(revealContent, 50);
            } else if (document.readyState === 'interactive') {
                // DOM parsed but resources still loading
                revealContent();
            } else {
                // DOM not ready yet
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(revealContent, 50);
                });
            }

            // Ultimate fallback - force show after 1 second
            setTimeout(revealContent, 1000);
        })();
        // #endregion premium FOUC prevention
    </script>
    <!-- Load scripts in dependency order -->
    <script src="js/storage.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}" onerror="console.error('Failed to load storage.js'); document.body.classList.add('loaded');"></script>
    <script src="js/categorizer.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}" onerror="console.error('Failed to load categorizer.js');"></script>
    <script src="js/news-fetcher.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}" onerror="console.error('Failed to load news-fetcher.js');"></script>
    <script src="js/article-renderer.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}" onerror="console.error('Failed to load article-renderer.js');"></script>
    <script src="js/weather.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}" onerror="console.error('Failed to load weather.js');"></script>
    <script src="js/tabs.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}" onerror="console.error('Failed to load tabs.js');"></script>
    <script src="js/stats.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}" onerror="console.error('Failed to load stats.js');"></script>
    <script src="js/main.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}" onerror="console.error('Failed to load main.js'); document.body.classList.add('loaded');"></script>
    <script src="js/zip-router.js?v={{ current_time|replace(' ', '')|replace(':', '')|replace('-', '') }}" onerror="console.error('Failed to load zip-router.js');"></script>
    <script>console.log('[FRNA] ‚úÖ Page loaded with cache-busting - build:', '{{ current_time }}');</script>
    <script>
        // Header scroll behavior - becomes fixed after scroll
        let headerNav = document.getElementById('headerNav');
        let lastScrollY = window.scrollY;

        window.addEventListener('scroll', () => {
            if (window.scrollY > 100) { // After 100px scroll
                headerNav.classList.add('fixed', 'top-0', 'left-0', 'right-0');
                headerNav.classList.remove('sticky');
                document.body.classList.add('pt-16'); // Add padding when fixed
            } else {
                headerNav.classList.remove('fixed', 'top-0', 'left-0', 'right-0');
                headerNav.classList.add('sticky');
                document.body.classList.remove('pt-16'); // Remove padding when sticky
            }
            lastScrollY = window.scrollY;
        });

        // Updated mobile menu functions for drawer behavior
        function openMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const panel = document.getElementById('mobileMenuPanel');

            menu.classList.remove('hidden');
            menu.classList.remove('opacity-0');
            setTimeout(() => {
                panel.classList.remove('translate-x-full');
                panel.classList.add('translate-x-0');
            }, 10);
        }

        function closeMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const panel = document.getElementById('mobileMenuPanel');

            panel.classList.remove('translate-x-0');
            panel.classList.add('translate-x-full');
            setTimeout(() => {
                menu.classList.add('hidden');
                menu.classList.add('opacity-0');
            }, 300);
        }

        // Update mobile nav toggle to use new function
        const hamburgerBtn = document.getElementById('mobileNavToggle');
        if (hamburgerBtn) {
            hamburgerBtn.addEventListener('click', function() {
                console.log('Hamburger clicked!');
                const menu = document.getElementById('mobileMenu');
                if (menu.classList.contains('hidden')) {
                    console.log('Opening menu');
                    openMobileMenu();
                } else {
                    console.log('Closing menu');
                    closeMobileMenu();
                }
            });
        } else {
            console.error('Hamburger button not found!');
        }

        document.getElementById('closeMobileMenu').addEventListener('click', closeMobileMenu);

        // Category toggle functionality with sticky persistence
        const categories = ['crime', 'sports', 'obituaries', 'food', 'entertainment', 'scanner', 'meetings', 'events'];

        // Load saved toggle states
        function loadToggleStates() {
            const savedStates = localStorage.getItem('hamburgerToggleStates');
            if (savedStates) {
                const states = JSON.parse(savedStates);
                categories.forEach(category => {
                    const toggle = document.getElementById(`toggle-${category}`);
                    if (toggle && states[category] !== undefined) {
                        toggle.checked = states[category];
                    }
                });
            }
        }

        // Save toggle states to localStorage
        function saveToggleStates() {
            const states = {};
            categories.forEach(category => {
                const toggle = document.getElementById(`toggle-${category}`);
                if (toggle) {
                    states[category] = toggle.checked;
                }
            });
            localStorage.setItem('hamburgerToggleStates', JSON.stringify(states));
        }

        // Initialize toggles and add event listeners
        categories.forEach(category => {
            const toggle = document.getElementById(`toggle-${category}`);
            const link = document.getElementById(`link-${category}`);

            if (toggle && link) {
                toggle.addEventListener('change', function() {
                    if (this.checked) {
                        link.style.opacity = '1';
                        link.style.pointerEvents = 'auto';
                        link.classList.remove('opacity-50', 'pointer-events-none');
                    } else {
                        link.style.opacity = '0.5';
                        link.style.pointerEvents = 'none';
                        link.classList.add('opacity-50', 'pointer-events-none');
                    }
                    // Save state immediately when changed
                    saveToggleStates();
                });
            }
        });

        // Load saved states when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadToggleStates();
            // Apply visual state to links based on loaded toggle states
            categories.forEach(category => {
                const toggle = document.getElementById(`toggle-${category}`);
                const link = document.getElementById(`link-${category}`);
                if (toggle && link) {
                    if (toggle.checked) {
                        link.style.opacity = '1';
                        link.style.pointerEvents = 'auto';
                        link.classList.remove('opacity-50', 'pointer-events-none');
                    } else {
                        link.style.opacity = '0.5';
                        link.style.pointerEvents = 'none';
                        link.classList.add('opacity-50', 'pointer-events-none');
                    }
                }
            });
        });

        // Image toggle functionality
        function toggleImages(showImages) {
            // Find all image and placeholder containers on the page
            const imageContainers = document.querySelectorAll('.image-container');
            const placeholderContainers = document.querySelectorAll('.placeholder-container');

            // Only manipulate containers if they exist (admin allows images)
            if (imageContainers.length > 0) {
                // Toggle all image containers
                imageContainers.forEach(container => {
                    if (showImages) {
                        container.classList.remove('hidden');
                    } else {
                        container.classList.add('hidden');
                    }
                });
            }

            if (placeholderContainers.length > 0) {
                // Toggle all placeholder containers
                placeholderContainers.forEach(container => {
                    if (showImages) {
                        container.classList.add('hidden');
                    } else {
                        container.classList.remove('hidden');
                    }
                });
            }

            // Save preference (only if admin allows images)
            {% if show_images %}
            localStorage.setItem('showImages', showImages);
            {% endif %}

            // Update body class for CSS image blocking
            if (showImages) {
                document.body.classList.remove('no-images');
            } else {
                document.body.classList.add('no-images');
            }
        }

        // Initialize image toggle
        const imageToggle = document.getElementById('toggle-images');
        if (imageToggle) {
            {% if show_images %}
            // Admin allows images - enable toggle functionality
            imageToggle.addEventListener('change', function() {
                toggleImages(this.checked);
            });

            // Load saved preference on page load
            const savedPreference = localStorage.getItem('showImages');
            if (savedPreference !== null) {
                const shouldShow = savedPreference === 'true';
                imageToggle.checked = shouldShow;
                toggleImages(shouldShow);
            } else {
                // Default to showing images if no preference saved
                imageToggle.checked = true;
                toggleImages(true);
            }
            {% else %}
            // Admin has disabled images - completely disable toggle
            imageToggle.disabled = true;
            imageToggle.checked = false;
            // Ensure images are hidden by adding no-images class and calling toggleImages
            document.body.classList.add('no-images');
            toggleImages(false);
            {% endif %}
        }

        // Lazy image loading
        document.addEventListener('DOMContentLoaded', function() {
            const images = document.querySelectorAll('img[data-src]');
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.classList.add('loaded');
                        observer.unobserve(img);
                    }
                });
            });
            images.forEach(img => imageObserver.observe(img));
        });
    </script>
    
    <!-- Generation Timestamp Badge (Bottom-Right) -->
    <div class="fixed bottom-4 right-4 z-50 text-gray-500 px-3 py-1.5 rounded-lg text-xs font-mono shadow-lg bg-[#161616]/60 backdrop-blur-sm border border-white/5">
        <div>Generated: {{ generation_timestamp or "TEMPLATE_NOT_WORKING" }}</div>
        {% if last_db_update %}<div>DB Updated: {{ last_db_update }}</div>{% else %}<div>DB Updated: TEMPLATE_NOT_WORKING</div>{% endif %}
    </div>
</body>
</html>